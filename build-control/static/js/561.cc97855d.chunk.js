"use strict";(self.webpackChunks_low_control=self.webpackChunks_low_control||[]).push([[561],{4179:function(e,n,t){t.r(n),t.d(n,{default:function(){return Ze}});var r=t(2498),i=t(447),c=t(7582);function s(e,n){if(!1===n(e))return!1;if(Array.isArray(null===e||void 0===e?void 0:e.children))for(var t=e.children.length-1;t>=0;t--)if(!s(e.children[t],n))return!1;return!0}var o=t(9651),a={id:"root",props:{},type:"",children:[]},d=c.V5.model("EditStore",{refreshId:c.V5.optional(c.V5.number,0),rightRefreshId:c.V5.optional(c.V5.number,0)}).volatile((function(){return{codeTree:a,selectId:"",isDragging:!1,iframeRef:{current:null},selectedComp:{},project:{},isChildInit:!1}})).views((function(e){return{get rootCode(){return e.codeTree}}})).actions((function(e){return{setProject:function(n){e.project=n},setCodeTree:function(n){e.codeTree=n},setIsDragging:function(n){e.isDragging=n},refresh:function(){e.refreshId+=1},refreshRight:function(){e.rightRefreshId+=1},setSelectId:function(n){e.selectId=n,e.updateSelectedComp()},updateSelectedComp:function(){s(e.codeTree,(function(n){return n.id!==e.selectId||(e.setSelectedComp(n),!1)}))},setSelectedComp:function(n){e.selectedComp=n},setIframeRef:function(n){e.iframeRef=n},updateSelected:function(n){var t=n.key,i=n.value;s(e.codeTree,(function(n){return n.id!==e.selectId||(n.props[t]=i,e.setSelectedComp((0,r.Z)({},n)),!1)})),e.postMessageIframe()},removeCom:function(n,t){s(e.codeTree,(function(e){return e.id!==n||(e.children.splice(t,1),!1)})),e.postMessageIframe()},postMessageIframe:function(){var n;null===(n=e.iframeRef.current)||void 0===n||n.contentWindow.postMessage({even:"updateCodeTree",params:e.codeTree},"*")},initIframe:function(){e.codeTree.children.length&&e.isChildInit&&this.postMessageIframe()},getChildMessage:function(n){var t=n.data;if("preview-init-success"===(void 0===t?{}:t).type)e.isChildInit=!0,(0,o.T)(),e.initIframe()},afterCreate:function(){},beforeDestroy:function(){}}})),l=t(4855),u=t(2453),f=t(8655),p=t(5297),h=t(8306),v=t(9197),m=t(8333),x="CARD",j=t(9485),g=t.n(j),y=t(6775);var C=(0,i.f3)("edit")((0,i.Pi)((function(e){var n=e.data,t=e.edit.setIsDragging,r=(0,m.c)((function(){return{type:x,item:{data:n},collect:function(e){var n=e.isDragging();return t(n),{isDragging:n}},end:function(){}}})),i=(0,v.Z)(r,2),c=i[0].isDragging,s=i[1];return(0,y.jsxs)("div",{ref:s,className:g()("p-2 text-center text-gray-600 cursor-move hover:bg-gray-100  hover:text-gray-900",{"opacity-50":c}),children:[(0,y.jsx)("div",{className:"mb-2",children:(0,y.jsx)("span",{className:"iconfont ".concat(n.iconfont)})}),(0,y.jsx)("div",{children:n.name})]})})));var w=function(e){var n=e.data;return(0,y.jsx)("div",{className:"py-6 px-4",children:(0,y.jsx)(p.Z,{gutter:15,children:n.map((function(e){return(0,y.jsx)(h.Z,{span:12,children:(0,y.jsx)(C,{data:e})},e.type)}))})})},Z=t(7208),N=t.n(Z),_=[{key:"base",panel:(0,y.jsx)(w,{data:N()})}];var I=function(){return(0,y.jsx)("div",{style:{width:221},children:_.map((function(e){return(0,y.jsx)(f.Fragment,{children:e.panel},e.key)}))})},b=t(4001),k=t(7405);var P={Input:function(e){var n=e.onChange,t=e.value;return(0,y.jsx)(k.Z,{value:t,onChange:function(e){return n(e.target.value)}})},title:""},T=t(4392),S=t.n(T),D=(0,r.Z)({},S()),E="EditTitle_wrapLabel__Mlixl",O=function(e){var n=e.name;return(0,y.jsx)("div",{className:E,children:(0,y.jsx)("span",{children:n})})},R=["key","name","type"];var M=(0,i.f3)("edit")((0,i.Pi)((function(e){var n=e.edit,t=n.selectedComp,i=n.updateSelected,c=n.setCodeTree,s=n.setSelectId,o=D[t.type]||{},a=o.list,d=void 0===a?[]:a,l=o.subLabelWidth,u=void 0===l?70:l;(0,f.useEffect)((function(){return window.addEventListener("message",h),function(){window.removeEventListener("message",h)}}),[]);var p=function(e){var n=e.key,i=(e.name,e.type),c=(0,b.Z)(e,R),s=P[i];return(0,y.jsx)(s,(0,r.Z)((0,r.Z)({},c),{},{value:null===t||void 0===t?void 0:t.props[n],onChange:function(e){return v(n,e)}}))};function h(e){var n=e.data,t=void 0===n?{}:n,r=t.type,i=t.params;if(i)switch(r){case"updateCodeTree":c(i);break;case"selectId":s(i)}}function v(e,n){i({key:e,value:n})}return(0,y.jsxs)("div",{className:"w-80 overflow-y-scroll",children:[(0,y.jsx)("div",{className:"h-6 leading-6 text-center font-medium border-b py-4",children:"\u5c5e\u6027\u8bbe\u7f6e"}),(0,y.jsx)("div",{className:"text-xs",children:t.type&&function e(n){return n.map((function(n){var i=n.key,c=n.name,s=n.children,o=n.type,a=n.component;switch(o){case"title":return(0,y.jsxs)("div",{children:[(0,y.jsx)(O,(0,r.Z)({},n),i),(0,y.jsx)("div",{className:"px-4 py-5",children:Array.isArray(s)&&e(s)})]},i);case"custom":return(0,y.jsxs)("div",{className:"flex items-center mb-2",children:[(0,y.jsx)("div",{style:{width:u},children:c}),(0,y.jsx)("div",{className:"ml-2 flex-1",children:a?(0,y.jsx)(a,(0,r.Z)((0,r.Z)({},n),{},{value:null===t||void 0===t?void 0:t.props[i],onChange:function(e){return v(i,e)}})):p(n)})]},i);default:return(0,y.jsxs)("div",{className:"flex items-center mb-2",children:[(0,y.jsx)("div",{style:{width:u},children:c}),(0,y.jsx)("div",{className:"ml-2 flex-1",children:p(n)})]},i)}}))}(d)})]})}))),L="PhoneContainer_ctn__X3Zou",A="PhoneContainer_ctnHead__8snkh",V="PhoneContainer_ctnBody__4csl5",W="PhoneContainer_ctnHeightTag__vz6rY";var z=function(e){var n=e.children;return(0,y.jsxs)("div",{className:L,children:[(0,y.jsx)("div",{className:A}),(0,y.jsx)("div",{className:V,children:n}),(0,y.jsx)("div",{className:W,children:(0,y.jsx)("span",{children:"iPhone 8\u624b\u673a\u9ad8\u5ea6"})})]})},J=t(5306),X=t(9451),Y="CenterCanvasIframe_phoneBody__IOusV",B="CenterCanvasIframe_iframe__Vm4k8",F="CenterCanvasIframe_pageLayer__yIXlO",H="FloatTab_floatTab__CAEvs",$=function(e){var n=e.name,t=e.isSelected,r=e.onDelete;return(0,y.jsx)("div",{className:g()("absolute",H),children:t?(0,y.jsx)("span",{onClick:r,className:"iconfont slow-shanchusekuai cursor-pointer text-gray-400 hover:text-gray-500\r\n"}):(0,y.jsx)("span",{children:n})})},U=(0,i.f3)("edit")((0,i.Pi)((function(e){var n=e.edit,t=e.drop,r=n.isDragging,i=n.codeTree,c=n.selectId,s=n.removeCom,o=i.children,a=void 0===o?[]:o;return(0,y.jsx)("div",{ref:t,className:F,style:{zIndex:r?20:1},children:a.map((function(e,n){return(0,y.jsx)("div",{className:"relative",style:{height:e.height||0},children:(0,y.jsx)($,{isSelected:c===e.id,name:e.name,onDelete:function(){return s(i.id,n)}})},e.id)}))})})));var q=(0,i.f3)("edit")((0,i.Pi)((function(e){var n=e.edit.setIframeRef,t=(0,f.useRef)(null);(0,f.useEffect)((function(){n(t)}),[]);var r=(0,X.L)((function(){return{accept:x,drop:function(e,n){if(!n.didDrop())return t.current.contentWindow.postMessage({even:"move",params:e},"*"),{}},collect:function(e){return{isOver:e.isOver({shallow:!0}),canDrop:e.canDrop(),item:e.getItem()}}}})),i=(0,v.Z)(r,2),c=i[0],s=(c.isOver,c.canDrop,c.item,i[1]);return(0,y.jsx)("div",{className:"flex-1 p-4 overflow-y-scroll bg-indigo-50",children:(0,y.jsx)(z,{children:(0,y.jsxs)("div",{className:Y,children:[(0,y.jsx)("iframe",{ref:t,src:"http://110.42.188.221:11002",className:B,id:J.X}),(0,y.jsx)(U,{drop:s})]})})})}))),G=t(5614),K=t(7037),Q=t(9534),ee=(0,i.f3)("edit")((0,i.Pi)((function(e){var n=e.edit.project,t=(0,G.s0)();return(0,y.jsxs)("div",{className:"inline-flex justify-between items-center h-full pl-6",children:[(0,y.jsx)(Q.Z,{className:"cursor-pointer color",onClick:function(){t(-1)}}),(0,y.jsx)("span",{className:"ml-2",children:null===n||void 0===n?void 0:n.name})]})}))),ne=t(1118),te=t(8121),re=(0,i.f3)("edit")((0,i.Pi)((function(e){var n=e.edit.project.id;return(0,y.jsx)(te.ZP,{onClick:function(){window.open("".concat("http://110.42.188.221:11002","/preview/").concat(n))},children:"\u5728\u7ebf\u5730\u5740"})}))),ie=t(1806),ce="Preview_iframe__E9pLu",se="Preview_box__+c+Tn";var oe=(0,i.f3)("edit")((0,i.Pi)((function(e){var n=e.edit.project.id,t=(0,f.useRef)(null);return(0,y.jsx)("iframe",{ref:t,src:"".concat("http://110.42.188.221:11002","/preview/").concat(n),className:ce})})));var ae=function(e){var n=e.className,t=(0,f.useState)(),r=(0,v.Z)(t,2),i=r[0],c=r[1];return(0,y.jsxs)("div",{className:n,children:[(0,y.jsx)(te.ZP,{type:"primary",onClick:function(){c(!0)},children:"\u9884\u89c8"}),(0,y.jsx)(ie.Z,{width:423,open:i,destroyOnClose:!0,onCancel:function(){return c(!1)},footer:null,children:(0,y.jsx)("div",{className:g()(se,"mt-10"),children:(0,y.jsx)(oe,{})})})]})},de=t(7637),le=(0,i.f3)("edit")((0,i.Pi)((function(e){var n=e.edit,t=n.codeTree,i=n.project;return(0,y.jsx)(te.ZP,{type:"primary",onClick:function(){(0,K.YD)((0,r.Z)((0,r.Z)({},i),{},{code:JSON.stringify(t.children)})).then((function(){de.Z.success({message:"\u4fdd\u5b58\u6210\u529f"})}))},children:"\u4fdd\u5b58"})}))),ue=t(9530),fe=(t(7930),t(1594),t(8733),t(9356)),pe=t(7735),he=t(6657),ve=t(7083),me=function(e){var n={};var t=function e(t){t.module&&(n[t.module]&&-1===n[t.module].indexOf(t.type)&&(n[t.module]=[].concat((0,fe.Z)(n[t.module]),[t.type])),n[t.module]||(n[t.module]=[t.type]));var r="";t.props&&Object.keys(t.props).forEach((function(e){if("children"!==e&&t.props[e]){var n=(0,he.Z)(t.props[e])?"{".concat(JSON.stringify(t.props[e]),"}"):"'".concat(t.props[e],"'");r="".concat(r," ").concat(e,"=").concat(n)}}));var i=t.children&&t.children.length>0?(0,ve.Z)(t.children,e).join(""):function(e){return(0,pe.Z)(e.props.children)?e.props.children:""}(t);return i?"<".concat(t.type||"").concat(r,">\n        ").concat(i,"\n      </").concat(t.type||"",">"):"<".concat(t.type||"div").concat(r," />")}(e),r="";return Object.keys(n).forEach((function(e){r+="import {".concat(n[e].join(","),"} from '").concat(e,"';")})),"import React from 'react';\n  ".concat(r,"\n\n  function App() {\n      return (\n          ").concat(t,"\n      );\n  }\n\n  export default App;")},xe=new Worker("./worker.js");var je=(0,i.f3)("edit")((0,i.Pi)((function(e){var n=e.edit,t=(0,f.useState)(""),r=(0,v.Z)(t,2),i=r[0],c=r[1];return(0,f.useEffect)((function(){xe.onmessage=function(e){c(e.data)}}),[]),(0,f.useEffect)((function(){var e=me(n.codeTree);xe.postMessage(e)}),[n.codeTree]),(0,y.jsx)("div",{children:(0,y.jsx)(ue.ZP,{style:{width:"100%"},mode:"javascript",theme:"monokai",name:"code",height:"560px",fontSize:16,editorProps:{$blockScrolling:!0},value:i,readOnly:!0})})})));var ge=function(){var e=(0,f.useState)(),n=(0,v.Z)(e,2),t=n[0],r=n[1];return(0,y.jsxs)("div",{children:[(0,y.jsx)(te.ZP,{onClick:function(){r(!0)},children:"Code"}),(0,y.jsx)(ie.Z,{title:"\u4ee3\u7801\u9884\u89c8",width:800,open:t,destroyOnClose:!0,onCancel:function(){return r(!1)},footer:null,children:(0,y.jsx)(je,{})})]})},ye=function(){return(0,y.jsx)("div",{className:"inline-flex justify-between items-center",children:(0,y.jsxs)(ne.Z,{children:[(0,y.jsx)(ae,{}),(0,y.jsx)(ge,{}),(0,y.jsx)(le,{}),(0,y.jsx)(re,{})]})})},Ce=function(){return(0,y.jsxs)("header",{className:"h-10 pr-3 shadow-sm sticky border-b border-gray-200 flex-shrink-0  flex justify-between items-center",children:[(0,y.jsx)(ee,{}),(0,y.jsx)(ye,{})]})},we=d.create();var Ze=function(){var e=(0,G.UO)().id;return(0,f.useEffect)((function(){return window.addEventListener("message",we.getChildMessage),function(){window.removeEventListener("message",we.getChildMessage)}}),[]),(0,f.useEffect)((function(){e&&(0,K.e5)(e).then((function(e){var n=we.codeTree,t=we.setProject,i=we.setCodeTree,c=we.initIframe;t(e),n.children=JSON.parse(e.code||"[]"),i((0,r.Z)({},n)),c()}))}),[e]),(0,y.jsx)(u.W,{backend:l.PD,children:(0,y.jsx)(i.zt,{edit:we,children:(0,y.jsxs)("div",{className:"flex flex-1 overflow-hidden flex-col text-gray-600 bg-white",children:[(0,y.jsx)(Ce,{}),(0,y.jsxs)("main",{className:"flex-1 overflow-hidden flex",children:[(0,y.jsx)(I,{}),(0,y.jsx)(q,{}),(0,y.jsx)(M,{})]})]})})})}},7037:function(e,n,t){t.d(n,{$L:function(){return s},YD:function(){return a},e5:function(){return c},ku:function(){return i},ty:function(){return o}});var r=t(1197);function i(e){return r.Z.get("/project",{params:e})}function c(e){return r.Z.get("/project/".concat(e))}function s(e){return r.Z.post("/project",e)}function o(e){return r.Z.patch("/project/".concat(e.id),e)}function a(e){return r.Z.patch("/project/code/".concat(e.id),e)}}}]);
//# sourceMappingURL=561.cc97855d.chunk.js.map