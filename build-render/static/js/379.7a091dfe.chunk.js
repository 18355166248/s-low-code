"use strict";(self.webpackChunks_low_render=self.webpackChunks_low_render||[]).push([[379],{2953:function(e,r,n){n.r(r);var t=n(8655),o=n.n(t),i=n(5180),d=n(8318),a=n(5614),c=n(6775);var s=function(){return(0,c.jsx)("div",{children:"404 Not"})},u=n(3859),l=n(7582),f=l.V5.model({name:l.V5.optional(l.V5.string,"\u7528\u6237\u540d")}),p=l.V5.model("AppStore",{userInfo:f}).volatile((function(){return{}})).views((function(e){return{get getIsOperate(){var r,n;return null===(r=e.userInfo)||void 0===r||null===(n=r.bizRoles)||void 0===n?void 0:n.includes(2)}}})).actions((function(e){return{setOpenKeys:function(r){e.openKeys=r},afterCreate:function(){},beforeDestroy:function(){}}})),v=n(2498),h=n(9197),m=n(9451),g=n(8333),I="CARD",x=n(8464),j=n.n(x),w=(0,v.Z)({},j()),T=n(9485),y=n.n(T);function Z(e){return["div"].indexOf(e)>-1}var C=function e(r){var n=r.id,o=r.parentId,i=r.data,d=r.index,a=r.selectId,s=r.edit,u=(0,t.useState)(!1),l=(0,h.Z)(u,2),f=l[0],p=l[1],x=(0,t.useRef)(null),j=w[i.type],T=(0,m.L)((function(){return{accept:I,drop:function(e,r){r.didDrop()||(e.data.id?s.moveCom({dragParentId:e.parentId,item:e.data,data:i,parentId:o,hoverIndex:d,dragIndex:e.index,positionDown:f}):s.appendCom({item:e.data,data:i,parentId:o,hoverIndex:d,positionDown:f}))},collect:function(e){return{isOver:e.isOver(),canDrop:e.canDrop(),isOverCurrent:e.isOver({shallow:!0})}},hover:function(e,r){if(r.isOver({shallow:!0})&&x.current){var n=x.current.getBoundingClientRect(),t=(n.bottom-n.top)/2,o=r.getClientOffset();if(o){var i=o.y-n.top;p(i>=t)}}}}}),[i,o,d,f,s]),C=(0,h.Z)(T,2),b=C[0],O=(b.isOver,b.canDrop,b.isOverCurrent),S=C[1],D=(0,g.c)((function(){return{type:I,item:{data:i,parentId:o,index:d},collect:function(e){return{isDragging:e.isDragging()}}}}),[d,o,i]),E=(0,h.Z)(D,2)[1],P=i.id===a;return S(E(x)),(0,c.jsxs)("div",{ref:x,onClick:function(e){e.stopPropagation(),s.setSelectId(i.id)},id:n,className:"relative",children:[(0,c.jsx)("div",{className:y()("absolute w-full h-full",{"border border-primary":P,"border border-primary border-dashed":O})}),(0,c.jsx)("div",{className:"absolute w-full h-full hover:border hover:border-primary hover:border-dashed"}),(0,c.jsx)(j,(0,v.Z)((0,v.Z)({},i.props),{},{children:Z(i.type)?i.children.map((function(r,n){return(0,c.jsx)(e,{data:r,parentId:i.id,index:n,edit:s,selectId:a},r.id)})):i.props.children}))]})};var b=(0,u.f3)("edit")((0,u.Pi)((function(e){var r=e.edit,n=(r.refreshId,r.append),o=r.selectId,i=r.setCodeTree;function d(e){if(e.source===window.parent&&e.data){var r=e.data,t=r.even,o=r.params;"move"===t&&function(e){n(e.data)}(o),"updateCodeTree"===t&&function(e){i(e)}(o)}}return(0,t.useEffect)((function(){return window.addEventListener("message",d),window.parent.postMessage({type:"preview-init-success"},"*"),function(){window.removeEventListener("message",d)}}),[]),(0,t.useLayoutEffect)((function(){r.codeTree&&r.codeTree.children.length&&(r.codeTree.children.map((function(e){var r,n=null===(r=document.getElementById(e.id))||void 0===r?void 0:r.offsetHeight;e.height=n})),window.parent.postMessage({type:"updateCodeTree",params:r.codeTree},"*"))}),[r.codeTree,r.codeTree.refreshId]),(0,t.useEffect)((function(){o&&window.parent.postMessage({type:"selectId",params:o},"*")}),[o]),(0,c.jsx)(c.Fragment,{children:r.codeTree.children.map((function(e,n){return(0,c.jsx)(C,{id:e.id,data:e,parentId:r.codeTree.id,index:n,edit:r,selectId:r.selectId},e.id)}))})}))),O=n(4855),S=n(2453),D=n(9356),E=n(5600);function P(e,r){if(!1===r(e))return!1;if(Array.isArray(null===e||void 0===e?void 0:e.children))for(var n=e.children.length-1;n>=0;n--)if(!P(e.children[n],r))return!1;return!0}var k=n(8567),A={id:"root",props:{},children:[],refreshId:0},L=l.V5.model("EditStore",{refreshId:l.V5.optional(l.V5.number,0)}).volatile((function(){return{codeTree:A,selectId:"",selectedComp:null}})).views((function(e){return{get rootCode(){return e.codeTree}}})).actions((function(e){return{setCodeTree:function(r){e.codeTree=r},refresh:function(){e.refreshId+=1},refreshCodeTree:function(){e.codeTree.refreshId+=1},setSelectId:function(r){e.selectId=r},append:function(r){var n=(0,E.Z)();e.codeTree=(0,v.Z)((0,v.Z)({},e.codeTree),{},{children:[].concat((0,D.Z)(e.codeTree.children),[(0,v.Z)((0,v.Z)({},(0,k.Z)(r)),{},{id:n,children:[]})])}),1===e.codeTree.children.length&&e.setSelectId(e.codeTree.children[0].id)},appendCom:function(r){var n=r.item,t=r.data,o=r.parentId,i=r.hoverIndex,d=r.positionDown,a=(0,E.Z)();P(e.codeTree,(function(e){return Z(t.type)||e.id!==o?!Z(t.type)||e.id!==t.id||(e.children.push((0,v.Z)((0,v.Z)({children:[]},(0,k.Z)(n)),{},{id:a})),!1):(d?e.children.splice(i+1,0,(0,v.Z)((0,v.Z)({children:[]},(0,k.Z)(n)),{},{id:a})):e.children.splice(i,0,(0,v.Z)((0,v.Z)({children:[]},(0,k.Z)(n)),{},{id:a})),!1)})),e.selectId=a,e.refreshCodeTree()},moveCom:function(r){var n=r.dragParentId,t=r.item,o=r.data,i=r.parentId,d=r.hoverIndex,a=r.dragIndex,c=r.positionDown;if(o.id!==t.id){var s=!1;P(t,(function(e){return e.id!==o.id||(s=!0,!1)})),s||(P(e.codeTree,(function(e){return e.id!==n||(e.children.splice(a,1),!1)})),e.appendCom({item:t,data:o,parentId:i,hoverIndex:d,positionDown:c}))}},moveRowRoot:function(r,n){var t=e.codeTree.children,o=t.splice(r,1)[0];t.splice(n,0,o),e.codeTree.children=(0,D.Z)(t)},removeCom:function(r,n){P(e.codeTree,(function(e){return e.id!==r||(e.children.splice(n,1),!1)})),e.refresh()},updateSelected:function(r){var n=r.key,t=r.value;P(e.codeTree,(function(r){return r.id!==e.selectId||(r.props[n]=t,!1)})),e.refresh()},afterCreate:function(){},beforeDestroy:function(){}}})).create();var R=function(){return(0,c.jsx)(S.W,{backend:O.PD,children:(0,c.jsx)(u.zt,{edit:L,children:(0,c.jsx)(b,{})})})},V=n(3928),_=n.n(V),N=n(9883);function W(e){e instanceof Object&&Object.keys(e).forEach((function(r){"string"===typeof e[r]&&(e[r]=e[r].trim())}))}function B(e){e instanceof Object&&Object.keys(e).forEach((function(r){var n=e[r];(void 0===n||null===n||"string"===typeof n&&""===n.trim())&&delete e[r]}))}var F,z=[function(e){return"get"===e.method?(W(e.params),B(e.params)):"post"===e.method&&(W(e.data),B(e.data)),e},function(e){return Promise.reject(e)}],K="SLOW_AUTH_TOKEN",M="SLOW_USER";function U(){localStorage.removeItem(K),localStorage.removeItem(M)}var q={timeout:5e3,responseType:"json",headers:{"Content-Type":"application/json"},baseURL:"".concat("http://110.42.188.221:13000","/api/v1")},H=_().create(q);(F=H.interceptors.request).use.apply(F,(0,D.Z)(z)),H.interceptors.request.use((function(e){var r=localStorage.getItem(K);return e.headers.Authorization="Bearer "+r,e}),(function(e){return Promise.reject(e)})),H.interceptors.response.use((function(e){var r,n;return 200!==(null===(r=e.data)||void 0===r?void 0:r.code)?(e.data.message&&N.Z.error({message:e.data.message}),Promise.reject(e.data.message)):null===(n=e.data)||void 0===n?void 0:n.data}),(function(e){var r;if(401===(null===e||void 0===e||null===(r=e.response)||void 0===r?void 0:r.status))return U(),window.location.replace("/login"),Promise.reject(e);var n=null===e||void 0===e?void 0:e.response.data;return n&&n.message&&N.Z.error({key:n.message,message:n.message}),Promise.reject(e)}));var J=H;var G=function e(r){var n=r.data,t=w[n.type];return(0,c.jsx)(t,(0,v.Z)((0,v.Z)({},n.props),{},{children:Z(n.type)?n.children.map((function(r){return(0,c.jsx)(e,{data:r},r.id)})):n.props.children}))},Q=function(){var e=(0,a.UO)().id,r=(0,t.useState)([]),n=(0,h.Z)(r,2),o=n[0],i=n[1];return(0,t.useEffect)((function(){e&&function(e){return J.get("/project/".concat(e))}(e).then((function(e){i(JSON.parse(e.code))}))}),[]),(0,c.jsx)("div",{children:Array.isArray(o)&&o.map((function(e){return(0,c.jsx)(G,{data:e},e.id)}))})},X=p.create({userInfo:{name:""}});var Y=function(){function e(e){var r,n=e.data,t=n.even,o=n.params;"updateToken"===t&&(r=o,localStorage.setItem(K,r))}return(0,t.useEffect)((function(){return window.addEventListener("message",e),function(){window.removeEventListener("message",e)}}),[]),(0,c.jsx)(u.zt,{app:X,children:(0,c.jsx)(d.VK,{children:(0,c.jsxs)(a.Z5,{children:[(0,c.jsx)(a.AW,{path:"/",element:(0,c.jsx)(R,{})}),(0,c.jsx)(a.AW,{path:"/preview/:id",element:(0,c.jsx)(Q,{})}),(0,c.jsx)(a.AW,{path:"*",element:(0,c.jsx)(s,{})})]})})})},$=function(e){e&&e instanceof Function&&n.e(293).then(n.bind(n,5293)).then((function(r){var n=r.getCLS,t=r.getFID,o=r.getFCP,i=r.getLCP,d=r.getTTFB;n(e),t(e),o(e),i(e),d(e)}))};i.createRoot(document.getElementById("root")).render((0,c.jsx)(o().StrictMode,{children:(0,c.jsx)(Y,{})})),$()}}]);
//# sourceMappingURL=379.7a091dfe.chunk.js.map