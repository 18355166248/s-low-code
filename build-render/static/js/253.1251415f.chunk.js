"use strict";(self.webpackChunks_low_render=self.webpackChunks_low_render||[]).push([[253],{6609:function(e,t,r){r.r(t);var n=r(8655),o=r.n(n),i=r(5180),d=r(8318),c=r(5614),a=r(6775);var s=function(){return(0,a.jsx)("div",{children:"404 Not"})},u=r(3859),l=r(7582),f=l.V5.model({name:l.V5.optional(l.V5.string,"\u7528\u6237\u540d")}),p=l.V5.model("AppStore",{userInfo:f}).volatile((function(){return{}})).views((function(e){return{get getIsOperate(){var t,r;return null===(t=e.userInfo)||void 0===t||null===(r=t.bizRoles)||void 0===r?void 0:r.includes(2)}}})).actions((function(e){return{setOpenKeys:function(t){e.openKeys=t},afterCreate:function(){},beforeDestroy:function(){}}})),v=r(2498),h=r(9197),m=r(9451),g=r(8333),I="CARD",y=r(8464),w=r.n(y),j=(0,v.Z)({},w()),x=r(9485),T=r.n(x);function Z(e){return["div"].indexOf(e)>-1}var C=function e(t){var r=t.id,o=t.parentId,i=t.data,d=t.index,c=t.selectId,s=t.edit,u=t.remotePreviewData,l=(0,n.useState)(!1),f=(0,h.Z)(l,2),p=f[0],y=f[1],w=(0,n.useRef)(null),x=j[i.type]||u[i.type],C=(0,m.L)((function(){return{accept:I,drop:function(e,t){t.didDrop()||(e.data.id?s.moveCom({dragParentId:e.parentId,item:e.data,data:i,parentId:o,hoverIndex:d,dragIndex:e.index,positionDown:p}):s.appendCom({item:e.data,data:i,parentId:o,hoverIndex:d,positionDown:p}))},collect:function(e){return{isOver:e.isOver(),canDrop:e.canDrop(),isOverCurrent:e.isOver({shallow:!0})}},hover:function(e,t){if(t.isOver({shallow:!0})&&w.current){var r=w.current.getBoundingClientRect(),n=(r.bottom-r.top)/2,o=t.getClientOffset();if(o){var i=o.y-r.top;y(i>=n)}}}}}),[i,o,d,p,s]),b=(0,h.Z)(C,2),D=b[0],O=(D.isOver,D.canDrop,D.isOverCurrent),E=b[1],P=(0,g.c)((function(){return{type:I,item:{data:i,parentId:o,index:d},collect:function(e){return{isDragging:e.isDragging()}}}}),[d,o,i]),S=(0,h.Z)(P,2)[1],k=i.id===c;return E(S(w)),(0,a.jsxs)("div",{ref:w,onClick:function(e){e.stopPropagation(),s.setSelectId(i.id)},id:r,className:"relative",children:[(0,a.jsx)("div",{className:T()("absolute w-full h-full",{"border border-primary":k,"border border-primary border-dashed":O})}),(0,a.jsx)("div",{className:"absolute w-full h-full hover:border hover:border-primary hover:border-dashed"}),x&&(0,a.jsx)(x,(0,v.Z)((0,v.Z)({},i.props),{},{children:Z(i.type)?i.children.map((function(t,r){return(0,a.jsx)(e,{data:t,parentId:i.id,index:r,edit:s,selectId:c,remotePreviewData:u},t.id)})):i.props.children}))]})},b=!1,D=r(6205);function O(e){var t=e.path,r=e.name;return new Promise((function(e,n){(0,D.importRemote)({url:b?"http://101.43.11.224:11000":"".concat("http://101.43.11.224:11000","/").concat(t),scope:r,module:"./preview"}).then((function(t){e(t.default)})).catch((function(e){n(e)}))}))}var E=r(3471);function P(e){return e.filter((function(e){return"object"===typeof e.remote})).reduce((function(e,t){return-1===e.findIndex((function(e){return e.type===t.type}))&&e.push(t),e}),[])}var S=(0,u.f3)("edit")((0,u.Pi)((function(e){var t=e.edit,r=(t.refreshId,t.append),o=t.selectId,i=t.setCodeTree,d=(0,n.useRef)({}),c=(0,E.Z)();function s(e){if(e.source===window.parent&&e.data){var t=e.data,n=t.even,o=t.params;"move"===n&&function(e){r(e.data)}(o),"updateCodeTree"===n&&function(e){i(e)}(o)}}return(0,n.useEffect)((function(){return window.addEventListener("message",s),window.parent.postMessage({type:"preview-init-success"},"*"),function(){window.removeEventListener("message",s)}}),[]),(0,n.useEffect)((function(){if(t.codeTree.children.length){var e=P(t.codeTree.children);e.forEach((function(t){O(t.remote).then((function(r){d.current[t.type]||(d.current[t.type]=r,Object.keys(d.current).length===e.length&&c())}))}))}}),[t.codeTree.children]),(0,n.useLayoutEffect)((function(){t.codeTree&&t.codeTree.children.length&&(t.codeTree.children.map((function(e){var t,r=null===(t=document.getElementById(e.id))||void 0===t?void 0:t.offsetHeight;e.height=r})),window.parent.postMessage({type:"updateCodeTree",params:t.codeTree},"*"))}),[t.codeTree,t.codeTree.refreshId]),(0,n.useEffect)((function(){o&&window.parent.postMessage({type:"selectId",params:o},"*")}),[o]),(0,a.jsx)(a.Fragment,{children:t.codeTree.children.map((function(e,r){return(0,a.jsx)(C,{id:e.id,data:e,parentId:t.codeTree.id,index:r,edit:t,selectId:t.selectId,remotePreviewData:d.current},e.id)}))})}))),k=r(4855),R=r(2453),A=r(9356),L=r(5600);function V(e,t){if(!1===t(e))return!1;if(Array.isArray(null===e||void 0===e?void 0:e.children))for(var r=e.children.length-1;r>=0;r--)if(!V(e.children[r],t))return!1;return!0}var _=r(8567),N={id:"root",props:{},children:[],refreshId:0},W=l.V5.model("EditStore",{refreshId:l.V5.optional(l.V5.number,0)}).volatile((function(){return{codeTree:N,selectId:"",selectedComp:null}})).views((function(e){return{get rootCode(){return e.codeTree}}})).actions((function(e){return{setCodeTree:function(t){e.codeTree=t},refresh:function(){e.refreshId+=1},refreshCodeTree:function(){e.codeTree.refreshId+=1},setSelectId:function(t){e.selectId=t},append:function(t){var r=(0,L.Z)();e.codeTree=(0,v.Z)((0,v.Z)({},e.codeTree),{},{children:[].concat((0,A.Z)(e.codeTree.children),[(0,v.Z)((0,v.Z)({},(0,_.Z)(t)),{},{id:r,children:[]})])}),1===e.codeTree.children.length&&e.setSelectId(e.codeTree.children[0].id)},appendCom:function(t){var r=t.item,n=t.data,o=t.parentId,i=t.hoverIndex,d=t.positionDown,c=(0,L.Z)();V(e.codeTree,(function(e){return Z(n.type)||e.id!==o?!Z(n.type)||e.id!==n.id||(e.children.push((0,v.Z)((0,v.Z)({children:[]},(0,_.Z)(r)),{},{id:c})),!1):(d?e.children.splice(i+1,0,(0,v.Z)((0,v.Z)({children:[]},(0,_.Z)(r)),{},{id:c})):e.children.splice(i,0,(0,v.Z)((0,v.Z)({children:[]},(0,_.Z)(r)),{},{id:c})),!1)})),e.selectId=c,e.refreshCodeTree()},moveCom:function(t){var r=t.dragParentId,n=t.item,o=t.data,i=t.parentId,d=t.hoverIndex,c=t.dragIndex,a=t.positionDown;if(o.id!==n.id){var s=!1;V(n,(function(e){return e.id!==o.id||(s=!0,!1)})),s||(V(e.codeTree,(function(e){return e.id!==r||(e.children.splice(c,1),!1)})),e.appendCom({item:n,data:o,parentId:i,hoverIndex:d,positionDown:a}))}},moveRowRoot:function(t,r){var n=e.codeTree.children,o=n.splice(t,1)[0];n.splice(r,0,o),e.codeTree.children=(0,A.Z)(n)},removeCom:function(t,r){V(e.codeTree,(function(e){return e.id!==t||(e.children.splice(r,1),!1)})),e.refresh()},updateSelected:function(t){var r=t.key,n=t.value;V(e.codeTree,(function(t){return t.id!==e.selectId||(t.props[r]=n,!1)})),e.refresh()},afterCreate:function(){},beforeDestroy:function(){}}})).create();var B=function(){return(0,a.jsx)(R.W,{backend:k.PD,children:(0,a.jsx)(u.zt,{edit:W,children:(0,a.jsx)(S,{})})})},F=r(3928),z=r.n(F),K=r(9734);function M(e){e instanceof Object&&Object.keys(e).forEach((function(t){"string"===typeof e[t]&&(e[t]=e[t].trim())}))}function U(e){e instanceof Object&&Object.keys(e).forEach((function(t){var r=e[t];(void 0===r||null===r||"string"===typeof r&&""===r.trim())&&delete e[t]}))}var q,H=[function(e){return"get"===e.method?(M(e.params),U(e.params)):"post"===e.method&&(M(e.data),U(e.data)),e},function(e){return Promise.reject(e)}],J="SLOW_AUTH_TOKEN",G="SLOW_USER";function Q(){localStorage.removeItem(J),localStorage.removeItem(G)}var X={timeout:5e3,responseType:"json",headers:{"Content-Type":"application/json"},baseURL:"".concat("http://101.43.11.224:13000","/api/v1")},Y=z().create(X);(q=Y.interceptors.request).use.apply(q,(0,A.Z)(H)),Y.interceptors.request.use((function(e){var t=localStorage.getItem(J);return e.headers.Authorization="Bearer "+t,e}),(function(e){return Promise.reject(e)})),Y.interceptors.response.use((function(e){var t,r;return 200!==(null===(t=e.data)||void 0===t?void 0:t.code)?(e.data.message&&K.Z.error({message:e.data.message}),Promise.reject(e.data.message)):null===(r=e.data)||void 0===r?void 0:r.data}),(function(e){var t;if(401===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status))return Q(),window.location.replace("/login"),Promise.reject(e);var r=null===e||void 0===e?void 0:e.response.data;return r&&r.message&&K.Z.error({key:r.message,message:r.message}),Promise.reject(e)}));var $=Y;var ee=function e(t){var r=t.data,n=t.remotePreviewData,o=j[r.type]||n[r.type];return o?(0,a.jsx)(o,(0,v.Z)((0,v.Z)({},r.props),{},{children:Z(r.type)?r.children.map((function(t){return(0,a.jsx)(e,{data:t,remotePreviewData:n},t.id)})):r.props.children})):null},te=function(){var e=(0,c.UO)().id,t=(0,n.useRef)({}),r=(0,E.Z)(),o=(0,n.useState)([]),i=(0,h.Z)(o,2),d=i[0],s=i[1];return(0,n.useEffect)((function(){e&&function(e){return $.get("/project/".concat(e))}(e).then((function(e){s(JSON.parse(e.code||"[]"))}))}),[]),(0,n.useEffect)((function(){if(d.length){var e=P(d);e.forEach((function(n){O(n.remote).then((function(o){t.current[n.type]||(t.current[n.type]=o,Object.keys(t.current).length===e.length&&r())}))}))}}),[d]),(0,a.jsx)("div",{children:Array.isArray(d)&&d.map((function(e){return(0,a.jsx)(ee,{data:e,remotePreviewData:t.current},e.id)}))})},re=p.create({userInfo:{name:""}});var ne=function(){function e(e){var t,r=e.data,n=r.even,o=r.params;"updateToken"===n&&(t=o,localStorage.setItem(J,t))}return(0,n.useEffect)((function(){return window.addEventListener("message",e),function(){window.removeEventListener("message",e)}}),[]),(0,a.jsx)(u.zt,{app:re,children:(0,a.jsx)(d.VK,{children:(0,a.jsxs)(c.Z5,{children:[(0,a.jsx)(c.AW,{path:"/",element:(0,a.jsx)(B,{})}),(0,a.jsx)(c.AW,{path:"/preview/:id",element:(0,a.jsx)(te,{})}),(0,a.jsx)(c.AW,{path:"*",element:(0,a.jsx)(s,{})})]})})})},oe=function(e){e&&e instanceof Function&&r.e(293).then(r.bind(r,5293)).then((function(t){var r=t.getCLS,n=t.getFID,o=t.getFCP,i=t.getLCP,d=t.getTTFB;r(e),n(e),o(e),i(e),d(e)}))};i.createRoot(document.getElementById("root")).render((0,a.jsx)(o().StrictMode,{children:(0,a.jsx)(ne,{})})),oe()}}]);
//# sourceMappingURL=253.1251415f.chunk.js.map